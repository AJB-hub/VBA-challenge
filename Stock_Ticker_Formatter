Sub Stock_Ticker_WB():

    For Each ws In Worksheets
        Dim lastRow
        Dim i 
        Dim dataTableRow 
        Dim openPrice As Double
        Dim closePrice As Double
        dim percentChange As Double
        dim totalStock

        'Formatting
        ws.Cells(1, 9).Value = "Ticker"
        ws.Cells(1, 10).Value = "Yearly Change"
        ws.Cells(1, 11).Value = "Percent Change"
        ws.Cells(1, 12).Value = "Total Stock Volume"
        ws.Cells(2,14).Value = "Greatest % Increase"
        ws.Cells(3,14).Value = "Greatest % Decrease"
        ws.Cells(4,14).Value = "Greatest Total Volume"
        ws.Columns("I:P").EntireColumn.AutoFit



        lastRow = ws.Cells(Rows.Count, 1).End(xlUp).row
        dataTableRow = 2
        openPrice = ws.Cells(2,3).Value

        For i = 2 To lastRow
            If ws.Cells(i, 1).Value <> ws.Cells(i + 1, 1).Value Then
                

                'set ticker 
                ws.Cells(dataTableRow,9).Value = ws.Cells(i, 1).Value
                'setting the last closing price
                closePrice = ws.Cells(i,6).Value

                'calculate the yearly change
                ws.Cells(dataTableRow,10).Value = closePrice - openPrice

                'conditional formatting
                If ws.Cells(dataTableRow,10).Value < 0 Then
                    ws.Cells(dataTableRow,10).Interior.ColorIndex = 3
                Else 
                    ws.Cells(dataTableRow,10).Interior.ColorIndex = 4
                End If


                'calculate the percent change (NOT WORKING)
                If openPrice <> 0 Then
                    percentChange = (closePrice - openPrice) / openPrice
                    with ws.Cells(dataTableRow,11)
                        .Value = percentChange 
                        .NumberFormat = "0.00%"
                    End With
                Else:
                End If

                

                'set first openPrice for the next ticker
                openPrice = ws.Cells(i+1, 3).Value

                'Calculate stock volume
                ws.Cells(dataTableRow,12).Value = totalStock + ws.Cells(i,7).Value


                'next ticker row
                dataTableRow = dataTableRow + 1
            Else
                totalStock = totalStock + ws.Cells(i,7).Value
            End If
        Next i
    
       
    Next ws

End Sub
